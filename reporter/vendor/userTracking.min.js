!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){var d=function(){"use strict";function b(){function b(){var a="test";try{return localStorage.setItem(a,a),localStorage.removeItem(a),!0}catch(b){return console.log("local storage is not supported in this browser"),!1}}function c(){var a=m.readCookie(h.SESSION_NAME);if(!a||"undefined"!==a){var b={status:!0,actionsToTrack:["click","dbclick","scroll","zoom"],duration:1e4};return i.log("TRACKING EVENTS:",b.actionsToTrack),m.createCookie(h.SESSION_NAME,JSON.stringify(b.actionsToTrack),b.duration),b.actionsToTrack}return[]}function d(a){a&&(g.interval=setInterval(function(){a>=Date.now()&&(k.checkStorageSize(!0),g.stopTracking())},h.INTERVAL_TIME))}function e(){var a=g.userActions.filter(function(a){return"startscreen"===a.eventType});g.userActions.length&&a||document.dispatchEvent(new CustomEvent("startscreen"))}function f(){var a=new Promise(function(a,b){var c=m.readCookie(h.KEY);null===c||void 0==c.replace(h.REGEXP,"$1")?l.getUserId().then(function(){a(m.readCookie(h.KEY))}):a(c)});return a}var g=new Object,h=a("./refactorConst.js"),i=a("./refactorConsole.js"),j=(a("./userDataManager.js"),a("./userActionListener.js")),k=a("./dataStorage.js"),l=a("./serverFunctions.js"),m=a("./cookieManager.js");return g.init=function(){b()&&(k.initializeActionsArray(),e(),f().then(function(){var a=c();a.length&&g.startTracking(a)}))},g.startTracking=function(a){i.log("recording actions"),g.sessionInProgress=!0,g.addListeners(a),d(a.endTime?a.endTime:Date.now()+h.SESSION_TIME)},g.stopTracking=function(){i.log("deleted session cookie"),g.sessionInProgress=!1,m.eraseCookie(h.SESSION_NAME),null!==m.readCookie(h.SESSION_NAME)&&m.createCookie(h.SESSION_NAME,h.SESSION_FAILED,1e3*g.sessionMinutes),g.removeListeners(),clearInterval(g.interval)},g.addListener=j.addListener,g.addListeners=j.addListeners,g.removeListeners=j.removeListeners,g.userActions=[],g.userActionsTemp=[],g.userActionsToSend=[],g.repeater=1,g.divider=0,g.isSending=!1,g.sessionInProgress=!1,g}function c(){return new b}var d;return{getInstance:function(){return d||(d=c()),d}}}();userTracking=d.getInstance(),userTracking.init()},{"./cookieManager.js":2,"./dataStorage.js":3,"./refactorConsole.js":6,"./refactorConst.js":7,"./serverFunctions.js":8,"./userActionListener.js":9,"./userDataManager.js":10}],2:[function(a,b,c){b.exports=function(){var a=function(a,b,c){var d="";if(c){var e=new Date;e.setTime(e.getTime()+1e3*c),d="; expires="+e.toGMTString()}else d="";document.cookie=a+"="+b+d+"; path=/"},b=function(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "===e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(b))return e.substring(b.length,e.length)}return null},c=function(b){a(b,"",-1)};return{createCookie:a,readCookie:b,eraseCookie:c}}()},{}],3:[function(a,b,c){b.exports=function(){"use strict";var b=a("./userDataManager.js"),c=a("./serverFunctions.js"),d=a("./refactorConst.js"),e=function(){var a=localStorage[d.KEY];if(void 0!==a){localStorage.removeItem(d.KEY);var b=userTracking.userActions.concat(JSON.parse(a));userTracking.userActions=b}else userTracking.userActions=[]},f=function(a){console.log("saveEventInfo",a),userTracking.userActions.push(a),h()},g=function(){userTracking.userActions.length=0},h=function(a){var e=userTracking.userActions.length;if(0===e&&a&&(a=!1),console.log("Log contains "+e+" item(s), and will sync after reaches "+d.MAX_ALLOWED_SIZE),e===d.MAX_ALLOWED_SIZE-1&&console.log("will sync after one more log entry"),e>=d.MAX_ALLOWED_SIZE&&e%userTracking.repeater===0||a&&e>1){if(userTracking.isSending===!0)return void console.log("won't send, because currently is sending");userTracking.isSending=!0,console.log("will send, because currently isn't sending"),0===userTracking.userActionsTemp.length&&(userTracking.userActionsTemp=userTracking.userActions.slice(0)),userTracking.userActionsToSend=userTracking.userActions.slice(userTracking.divider),g();b.formUserData(userTracking.userActionsToSend);c.sendEventsToServer(userTracking.userActionsToSend)}},i=function(){userTracking.userActionsTemp&&userTracking.userActionsTemp.length&&(userTracking.userActions=userTracking.userActions.concat(userTracking.userActionsTemp)),userTracking.userActions.length>0&&(localStorage.setItem(d.KEY,JSON.stringify(userTracking.userActions)),console.log("wrote actions to local storage"))};return{initializeActionsArray:e,saveEventInfo:f,clearData:g,checkStorageSize:h,writeActionsToStorage:i}}()},{"./refactorConst.js":7,"./serverFunctions.js":8,"./userDataManager.js":10}],4:[function(a,b,c){b.exports=function(){"use strict";function b(a){var b,c;if((a.clientX||a.clientY)&&document.body&&null!==document.body.scrollLeft&&(b=a.clientX+document.body.scrollLeft,c=a.clientY+document.body.scrollTop),(a.clientX||a.clientY)&&"CSS1Compat"===document.compatMode&&document.documentElement&&null!==document.documentElement.scrollLeft&&(b=a.clientX+document.documentElement.scrollLeft,c=a.clientY+document.documentElement.scrollTop),(a.pageX||a.pageY)&&(b=a.pageX,c=a.pageY),"scroll"===a.type&&(b=pageXOffset,c=pageYOffset),("focus"===a.type||"change"===a.type)&&a.target.getBoundingClientRect){var d=document.body.getBoundingClientRect(),e=a.target.getBoundingClientRect();b=e.top-d.top,c=e.left-d.left}return h.calculate({X:b,Y:c})}function c(){var a,b;return document.body&&document.body.offsetWidth&&(a=document.body.offsetWidth,b=document.body.offsetHeight),"CSS1Compat"==document.compatMode&&document.documentElement&&document.documentElement.offsetWidth&&(a=document.documentElement.offsetWidth,b=document.documentElement.offsetHeight),window.innerWidth&&window.innerHeight&&(a=window.innerWidth,b=window.innerHeight),{width:a,height:b}}function d(a){var b;switch(a.type){case"click":case"dblclick":case"focus":case"dragstart":case"drop":case"change":b=new f(a);break;case"resize":case"startscreen":b=new e(a);break;case"scroll":b=new g(a)}return b}function e(a){var b=document.body,d=document.documentElement;this.type=a.type,this.time=Date.now(),this.documentHeight=Math.max(b.scrollHeight,b.offsetHeight,d.clientHeight,d.scrollHeight,d.offsetHeight),this.documentWidth=Math.max(b.scrollWidth,b.offsetWidth,d.clientWidth,d.scrollWidth,d.offsetWidth);var e=c();this.screenWidth=e.width,this.screenHeight=e.height,this.path=window.location.pathname}function f(a){e.call(this,a),a.target&&a.target.id&&(this.elementId=a.target.id);var c=b(a);this.positionX=c.X,this.positionY=c.Y}function g(a){e.call(this,a),this.screenWidth=window.innerWidth,this.screenHeight=window.innerHeight}var h=a("./utils/precision.js");return f.prototype=e,f.prototype.constructor=f,g.prototype=e,g.prototype.constructor=g,{createEvent:d}}()},{"./utils/precision.js":11}],5:[function(a,b,c){b.exports=function(){"use strict";var a=[],b=function(b,c){var d=a[a.indexOf(this)];return d.channels[b]||(d.channels[b]=[]),d.channels[b].push({context:this,callback:c}),console.log("sub",this,b,c),this},c=function(b){var c=a[a.indexOf(this)],d=c.channels[b];if(d){var e=Array.prototype.slice.call(arguments,1);console.log("publish",this,b);for(var f=0,g=d.length;g>f;f++){var h=d[f];console.log("publish subscription",h),h.callback.apply(h.context,e)}return this}};return{installTo:function(d){d.channels=[],a.push(d),d.subscribe=b,d.publish=c}}}()},{}],6:[function(a,b,c){b.exports=function(){var a=function(){console.log.apply(console,arguments)},b=function(){console.info?console.info.apply(console,arguments):a(arguments)},c=function(){console.warn?console.warn.apply(console,arguments):a(arguments)},d=function(){console.error?console.error.apply(console,arguments):a(arguments)};return{log:a,info:b,warn:c,error:d}}()},{}],7:[function(a,b,c){b.exports=function(){var a="http://localhost:3000/api/",b="userTracking",c="SessionId";return{SESSION_STOPPED:"doNothing",SESSION_FAILED:"failed",SESSION_NAME:"userTracking",SESSION_TIME:216e6,INTERVAL_TIME:2e4,MAX_ALLOWED_SIZE:5,KEY:b,VISITKEY:c,REGEXP:new RegExp("(?:(?:^|.*;s*)"+b+"s*=s*([^;]*).*$)|^.*$"),BASE:a}}()},{}],8:[function(a,b,c){b.exports=function(){"use strict";function b(){userTracking.isSending=!1,console.log("success"),console.log("minus",Math.abs(userTracking.userActionsTemp.length-userTracking.userActionsToSend.length));var a=Math.abs(userTracking.userActionsTemp.length-userTracking.userActionsToSend.length);userTracking.userActions=userTracking.userActionsTemp.slice(0,a).concat(userTracking.userActions),console.log("success, left:",userTracking.userActions.length),userTracking.userActionsToSend.length=0,userTracking.userActionsTemp.length=0,userTracking.repeater=1,userTracking.divider=0}function c(a){switch(console.log("failure, but setted cookie and deleted logs"),userTracking.isSending=!1,a.detail.status){case 0:userTracking.repeater=3,void 0!==userTracking.userActionsTemp&&userTracking.userActionsTemp.length>0&&(userTracking.userActions=userTracking.userActions.concat(userTracking.userActionsTemp)),userTracking.userActionsTemp.length=0,console.log("server down");break;case 401:e.deleteCookies();var b=JSON.parse(a.detail.responseText).userId;e.createCookie(d.KEY,b,999999),DataStorage.clearData();break;case 413:console.log("too much info sent"),void 0!==userTracking.userActionsTemp&&userTracking.userActionsTemp.length>0&&(userTracking.userActions=userTracking.userActions.concat(userTracking.userActionsTemp)),console.log("asdasdsa",userTracking.userActions.length),userTracking.userActionsTemp.length=0,0===userTracking.divider?(console.log("userTracking.divider 0",userTracking.divider),userTracking.divider=userTracking.userActions.length/2):(console.log("userTracking.divider > 0",userTracking.divider),userTracking.divider+=userTracking.divider/2),userTracking.divider.length>=userTracking.userActions.length&&(userTracking.userActionsToSend.length=0,userTracking.userActionsTemp.length=0,userTracking.repeater=1,userTracking.divider=0,DataStorage.clearData()),console.log("userTracking.divider",userTracking.divider)}}var d=a("./refactorConst.js"),e=a("./cookieManager.js"),f=a("./userDataManager.js"),g=a("./xhrService.js"),h=f.getModel(),i=function(a){var f={events:a};console.log("sendingToServer"),console.log(e.readCookie(d.VISITKEY)),g.POST(d.BASE+"Visits/"+e.readCookie(d.VISITKEY)+"/event",f).then(function(a,c,d){return b(),!0},function(a,b,d){var e=JSON.parse(a.target.response);return c(e),!1})},j=function(a){g.POST(d.BASE+"users/"+e.readCookie(d.KEY)+"/visits/",{startTime:Date.now()}).then(function(b,c,f){var g=JSON.parse(b.target.response);return console.log("seting session data",g.id),e.createCookie(d.VISITKEY,g.id,863999136e5),console.log("setting visit id"),a(),!0})},k=function(){var a={};a.title="userTracking",a.w=screen.width,a.h=screen.height,a.registrationTime=Date.now(),console.log(a);var b=new Promise(function(b,c){g.POST(d.BASE+"users",a).then(function(a,c,f){var g=JSON.parse(a.target.response);console.log("setting users data",g),e.createCookie(d.KEY,g.id,863999136e5),j(b),h.publish("userLogin",g.id)},function(a,c,f){j(b),console.log("setCookies","unregistered"),e.createCookie(d.KEY,"unregistered",863999136e5),console.log("o ffs"),h.publish("userLogout")})});return b},l=function(a){var b={};b.hostname=location.host,b.startTime=Date.now(),g.POST(d.BASE+"users/"+e.readCookie(d.KEY)+"/visits",b).then(function(b,c,d){var e=JSON.parse(b.target.response);a(e)},function(a,b,c){return!1})};return{sendEventsToServer:i,shouldRecord:l,getUserId:k}}()},{"./cookieManager.js":2,"./refactorConst.js":7,"./userDataManager.js":10,"./xhrService.js":12}],9:[function(a,b,c){b.exports=function(){"use strict";function b(a){var b=l.createEvent(a);k.saveEventInfo(b)}function c(a){j.log(a.detail),b(a)}function d(a){p&&(p=!1,j.log("click"),b(a),setTimeout(function(){p=!0},250))}function e(a){h&&clearTimeout(h),h=setTimeout(function(){j.log("resize"),b(a)},400)}function f(a){j.log("unload"),k.writeActionsToStorage()}function g(a){i&&clearTimeout(i),i=setTimeout(function(){j.log("scroll"),b(a)},400)}var h,i,j=a("./refactorConsole.js"),k=(a("./userDataManager.js"),a("./dataStorage.js")),l=a("./eventFactory.js"),m=function(a){o(),j.log("settings passed to action lisener",a),document.addEventListener("startscreen",c,!1),window.addEventListener("unload",f,!1);for(var b="string"==typeof a?a.split(","):a,d=0,e=b.length;e>d;d++)n(b[d])},n=function(a){switch(a=a.trim()){case"dblclick":case"change":case"dragstart":case"drop":document.addEventListener(a,c,!1);break;case"focus":document.addEventListener(a,c,!0);break;case"click":document.addEventListener("click",d,!1);break;case"resize":window.addEventListener("resize",e,!1);break;case"scroll":window.addEventListener("scroll",g,!1)}},o=function(){j.log("stopped listening to actions"),document.removeEventListener("click",d,!1),document.removeEventListener("dblclick",c,!1),window.removeEventListener("resize",e,!1),document.removeEventListener("startscreen",c,!1),document.removeEventListener("change",c,!1),window.removeEventListener("unload",f,!1),window.removeEventListener("scroll",g,!1),document.removeEventListener("dragstart",c,!1),document.removeEventListener("drop",c,!1),document.removeEventListener("focus",c,!0)},p=!0;return{addListener:n,addListeners:m,removeListeners:o}}()},{"./dataStorage.js":3,"./eventFactory.js":4,"./refactorConsole.js":6,"./userDataManager.js":10}],10:[function(a,b,c){b.exports=function(){"use strict";function b(){return console.log("user id was set:"+i.id),h.readCookie(f.KEY)?!0:(console.log("id was undefined"),!1)}function c(){j=document.domain,console.log("Domain: "+document.domain)}function d(a){b()&&(k=a),c();var d={userID:i.id,url:j,actions:k};return d}function e(){return i}var f=a("./refactorConst.js"),g=a("./mediator.js"),h=a("./cookieManager.js"),i={id:null},j=null,k=[];return function(){g.installTo(i),i.subscribe("userLogin",function(a){i.id=a}),i.subscribe("userLogout",function(){i.id=null})}(),{formUserData:d,getModel:e}}()},{"./cookieManager.js":2,"./mediator.js":5,"./refactorConst.js":7}],11:[function(a,b,c){b.exports=function(){function a(){this.calculate=function(a){return a}}function b(){this.calculate=function(a){return a.X=10*Math.floor(a.X/10),a.Y=10*Math.floor(a.Y/10),a}}function c(){this.calculate=function(a){return a.X=10*Math.ceil(a.X/10),a.Y=10*Math.ceil(a.Y/10),a}}function d(a){this.calculate=function(b){return b.X=Math.floor(b.X/a)*a,b.Y=Math.ceil(b.Y/a)*a,b}}function e(a){this.calculate=function(b){return b.X=Math.ceil(b.X/a)*a,b.Y=Math.ceil(b.Y/a)*a,b}}var f=new a;return{setPrecision:function(a){f=a},calculate:function(a){return f.calculate(a)},pixelPrecision:a,tenthsFloorPrecision:b,tenthsCeilPrecision:c,customFloorPrecition:d,customCeilPrecition:e}}()},{}],12:[function(a,b,c){b.exports=function(){var a=function(a,b,c){function d(a){if(g(),200===a.target.status){var b;return a.target.response&&(b=JSON.parse(a.target.response)),b}e(a)}function e(a){g();var b;try{b=JSON.parse(a.target.response),b.error.message=ErrorMessageTranslator.formatMessage(b.error.code,b.error.message)}catch(c){b&&b.error&&(b.error.message=a.target.status+": "+a.target.statusText)}return a}function f(a){g(),i.reject("Upload canceled.")}function g(){h.removeEventListener("load",d),h.removeEventListener("error",e),h.removeEventListener("abort",f)}var h=new XMLHttpRequest,i=new Promise(function(d,e){h.addEventListener("load",d,!1),h.addEventListener("error",e,!1),h.addEventListener("abort",f,!1);try{h.open(a,b)}catch(j){return g(),i.reject(j),i}c instanceof FormData||(h.setRequestHeader("Content-Type","application/json"),c=JSON.stringify(c)),h.send(c)});return i},b=function(b,c){return a("GET",b,c)},c=function(b,c){return a("POST",b,c)},d=function(b,c){return a("DELETE",b,c)},e=function(b,c){return a("PATCH",b,c)},f=function(b,c){return a("PUT",b,c)};return{GET:b,POST:c,PUT:f,DELETE:d,PATCH:e}}()},{}]},{},[1]);